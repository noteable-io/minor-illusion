version: '3.8'

services:
  backend:
    build:
      context: ./backend
      target: debug
    ports:
      - 5678:5678 # to attach debug
      - 8000:8000 # actual webapp
    volumes:
      - ./backend/src/app:/usr/src/app

  cockroach:
    image: cockroachdb/cockroach-unstable:v21.2.0-beta.4
    command: start-single-node --insecure --listen-addr=0.0.0.0:26257

  jupyter:
    build: ./jupyter
    ports:
      - 8888:8888
    volumes:
      - ./jupyter/notebooks:/home/jovyan/notebooks   
      - ./backend/src/app:/home/jovyan/backend/app:ro
    environment:
      PYTHONPATH: /home/jovyan/backend

  tox:
    build:
      context: ./backend
      target: tox
    volumes:
      - ./backend/src/app:/usr/src/app
      - ./backend/src/tests:/usr/src/tests
    command: ["tail", "-f", "/dev/null"]

  frontend:
    build: ./frontend
    ports:
      - 3000:3000
